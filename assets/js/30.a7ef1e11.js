(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{383:function(e,t,a){"use strict";a.r(t);var s=a(25),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[e._v("è½¬è½½")]),e._v(" "),a("p",[e._v("æœ¬æ–‡è½¬è½½è‡ªåšå®¢å›­ rickiyang "),a("a",{attrs:{href:"https://www.cnblogs.com/rickiyang/p/13265043.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("é›¶æ‹·è´(Zero-copy) æµ…æåŠå…¶åº”ç”¨"),a("OutboundLink")],1)])]),e._v(" "),a("h2",{attrs:{id:"linux-i-o-è¯»å†™æ–¹å¼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-i-o-è¯»å†™æ–¹å¼"}},[e._v("ğŸ‹")]),e._v(" Linux I/O è¯»å†™æ–¹å¼")]),e._v(" "),a("p",[e._v("Linux æä¾›äº†è½®è¯¢ã€I/O ä¸­æ–­ä»¥åŠ DMA ä¼ è¾“è¿™ 3 ç§ç£ç›˜ä¸ä¸»å­˜ä¹‹é—´çš„æ•°æ®ä¼ è¾“æœºåˆ¶ã€‚å…¶ä¸­è½®è¯¢æ–¹å¼æ˜¯åŸºäºæ­»å¾ªç¯å¯¹ I/O ç«¯å£è¿›è¡Œä¸æ–­æ£€æµ‹ã€‚I/O ä¸­æ–­æ–¹å¼æ˜¯æŒ‡å½“æ•°æ®åˆ°è¾¾æ—¶ï¼Œç£ç›˜ä¸»åŠ¨å‘ CPU å‘èµ·ä¸­æ–­è¯·æ±‚ï¼Œç”± CPU è‡ªèº«è´Ÿè´£æ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ã€‚ DMA ä¼ è¾“åˆ™åœ¨ I/O ä¸­æ–­çš„åŸºç¡€ä¸Šå¼•å…¥äº† DMA ç£ç›˜æ§åˆ¶å™¨ï¼Œç”± DMA ç£ç›˜æ§åˆ¶å™¨è´Ÿè´£æ•°æ®çš„ä¼ è¾“ï¼Œé™ä½äº† I/O ä¸­æ–­æ“ä½œå¯¹ CPU èµ„æºçš„å¤§é‡æ¶ˆè€—ã€‚")]),e._v(" "),a("h3",{attrs:{id:"i-o-ä¸­æ–­"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i-o-ä¸­æ–­"}},[e._v("ğŸ‹")]),e._v(" I/O ä¸­æ–­")]),e._v(" "),a("p",[e._v("åœ¨ DMA æŠ€æœ¯å‡ºç°ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºä¸ç£ç›˜ä¹‹é—´çš„ I/O æ“ä½œéƒ½æ˜¯é€šè¿‡ CPU çš„ä¸­æ–­å®Œæˆçš„ã€‚æ¯æ¬¡ç”¨æˆ·è¿›ç¨‹è¯»å–ç£ç›˜æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦ CPU ä¸­æ–­ï¼Œç„¶åå‘èµ· I/O è¯·æ±‚ç­‰å¾…æ•°æ®è¯»å–å’Œæ‹·è´å®Œæˆï¼Œæ¯æ¬¡çš„ I/O ä¸­æ–­éƒ½å¯¼è‡´ CPU çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy1.png",alt:"4"}})]),e._v(" "),a("p",[e._v("ä½¿ç”¨ I/O ä¸­æ–­æ–¹å¼è¯»å–æ•°æ®æ­¥éª¤ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹å‘ CPU å‘èµ· read ç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€ï¼Œç„¶åä¸€ç›´é˜»å¡ç­‰å¾…æ•°æ®çš„è¿”å›ï¼›")]),e._v(" "),a("li",[e._v("CPU åœ¨æ¥æ”¶åˆ°æŒ‡ä»¤ä»¥åå¯¹ç£ç›˜å‘èµ· I/O è¯·æ±‚ï¼Œå°†ç£ç›˜æ•°æ®å…ˆæ”¾å…¥ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºï¼›")]),e._v(" "),a("li",[e._v("æ•°æ®å‡†å¤‡å®Œæˆä»¥åï¼Œç£ç›˜å‘ CPU å‘èµ· I/O ä¸­æ–­ï¼›")]),e._v(" "),a("li",[e._v("CPU æ”¶åˆ° I/O ä¸­æ–­ä»¥åå°†ç£ç›˜ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åå†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼›")]),e._v(" "),a("li",[e._v("ç”¨æˆ·è¿›ç¨‹ç”±å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œè§£é™¤é˜»å¡çŠ¶æ€ï¼Œç„¶åç­‰å¾… CPU çš„ä¸‹ä¸€ä¸ªæ‰§è¡Œæ—¶é—´é’Ÿã€‚")])]),e._v(" "),a("h3",{attrs:{id:"dma"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dma"}},[e._v("ğŸ‹")]),e._v(" DMA")]),e._v(" "),a("p",[e._v("DMA(Direct Memory Access)å³ç›´æ¥å­˜å‚¨å™¨å­˜å–ï¼Œæ˜¯æŒ‡å¤–éƒ¨è®¾å¤‡ä¸é€šè¿‡ CPU è€Œç›´æ¥ä¸ç³»ç»Ÿå†…å­˜äº¤æ¢æ•°æ®çš„æ¥å£æŠ€æœ¯ã€‚")]),e._v(" "),a("p",[e._v("è¦æŠŠå¤–è®¾çš„æ•°æ®è¯»å…¥å†…å­˜æˆ–æŠŠå†…å­˜çš„æ•°æ®ä¼ é€åˆ°å¤–è®¾ï¼Œä¸€èˆ¬éƒ½è¦é€šè¿‡ CPU æ§åˆ¶å®Œæˆï¼Œå¦‚ CPU ç¨‹åºæŸ¥è¯¢æˆ–ä¸­æ–­æ–¹å¼ã€‚åˆ©ç”¨ä¸­æ–­è¿›è¡Œæ•°æ®ä¼ é€ï¼Œå¯ä»¥å¤§å¤§æé«˜ CPU çš„åˆ©ç”¨ç‡ã€‚ä½†æ˜¯é‡‡ç”¨ä¸­æ–­ä¼ é€æœ‰å®ƒçš„ç¼ºç‚¹ï¼Œå¯¹äºä¸€ä¸ªé«˜é€Ÿ I/O è®¾ å¤‡ä»¥åŠæ‰¹é‡äº¤æ¢æ•°æ®çš„æƒ…å†µï¼Œå¦‚æœä¸­æ–­ I/O æ“ä½œå¸¦æ¥çš„å°†æ˜¯æ€§èƒ½çš„æŸè€—ã€‚å¯¹äºè¿™ç§ç±»å‹çš„æ“ä½œå¦‚æœå¯ä»¥æ‰¾ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¥æ‰§è¡Œæ•°æ®æ‹·è´è€Œ I/O è¿˜ç»§ç»­æ‰§è¡Œæ•°æ®è¯»å–ä¸»æµç¨‹ä»»åŠ¡æ˜¯æœ€å¥½çš„ã€‚DMA åœ¨å¤–è®¾ä¸å†…å­˜é—´ç›´æ¥è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œè€Œä¸é€šè¿‡ CPUï¼Œè¿™æ ·æ•°æ®ä¼ é€çš„é€Ÿåº¦å°±å–å†³äºå­˜å‚¨å™¨å’Œå¤–è®¾çš„å·¥ä½œé€Ÿåº¦ã€‚")]),e._v(" "),a("p",[e._v("é€šå¸¸ç³»ç»Ÿçš„æ€»çº¿æ˜¯ç”± CPU ç®¡ç†çš„ã€‚åœ¨ DMA æ–¹å¼æ—¶ï¼Œå°±å¸Œæœ› CPU æŠŠè¿™äº›æ€»çº¿è®©å‡ºæ¥ï¼Œå³ CPU è¿åˆ°è¿™äº›æ€»çº¿ä¸Šçš„çº¿å¤„äºç¬¬ä¸‰æ€ï¼šé«˜é˜»çŠ¶æ€ï¼Œè€Œç”± DMA æ§åˆ¶å™¨æ¥ç®¡ï¼Œæ§åˆ¶ä¼ é€çš„å­—èŠ‚æ•°ï¼Œåˆ¤æ–­ DMA æ˜¯å¦ç»“æŸï¼Œä»¥åŠå‘å‡º DMA ç»“æŸä¿¡å·ã€‚DMA æ§åˆ¶å™¨å¿…é¡»æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š")]),e._v(" "),a("p",[e._v("1. èƒ½å‘ CPU å‘å‡ºç³»ç»Ÿä¿æŒ(HOLD)ä¿¡å·ï¼Œæå‡ºæ€»çº¿æ¥ç®¡è¯·æ±‚ï¼›\nã€€ã€€2. å½“ CPU å‘å‡ºå…è®¸æ¥ç®¡ä¿¡å·åï¼Œè´Ÿè´£å¯¹æ€»çº¿çš„æ§åˆ¶ï¼Œè¿›å…¥ DMA æ–¹å¼ï¼›\nã€€ã€€3. èƒ½å¯¹å­˜å‚¨å™¨å¯»å€åŠèƒ½ä¿®æ”¹åœ°å€æŒ‡é’ˆï¼Œå®ç°å¯¹å†…å­˜çš„è¯»å†™æ“ä½œï¼›\nã€€ã€€4. èƒ½å†³å®šæœ¬æ¬¡ DMA ä¼ é€çš„å­—èŠ‚æ•°ï¼Œåˆ¤æ–­ DMA ä¼ é€æ˜¯å¦ç»“æŸï¼›\nã€€ã€€5. å‘å‡º DMA ç»“æŸä¿¡å·ï¼Œä½¿ CPU æ¢å¤æ­£å¸¸å·¥ä½œçŠ¶æ€ã€‚")]),e._v(" "),a("p",[e._v("æœ‰äº†DMAä¹‹åçš„æ•°æ®è¯»å–æ–¹å¼å°±å˜äº†ï¼š")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy2.png",alt:"5"}})]),e._v(" "),a("p",[e._v("CPU ä»ç¹é‡çš„ I/O æ“ä½œä¸­è§£è„±ï¼Œæ•°æ®è¯»å–æ“ä½œçš„æµç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹å‘ CPU å‘èµ· read ç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€ï¼Œç„¶åä¸€ç›´é˜»å¡ç­‰å¾…æ•°æ®çš„è¿”å›ï¼›")]),e._v(" "),a("li",[e._v("CPU åœ¨æ¥æ”¶åˆ°æŒ‡ä»¤ä»¥åå¯¹ DMA ç£ç›˜æ§åˆ¶å™¨å‘èµ·è°ƒåº¦æŒ‡ä»¤ï¼›")]),e._v(" "),a("li",[e._v("DMA ç£ç›˜æ§åˆ¶å™¨å¯¹ç£ç›˜å‘èµ· I/O è¯·æ±‚ï¼Œå°†ç£ç›˜æ•°æ®å…ˆæ”¾å…¥ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºï¼ŒCPU å…¨ç¨‹ä¸å‚ä¸æ­¤è¿‡ç¨‹ï¼›")]),e._v(" "),a("li",[e._v("æ•°æ®è¯»å–å®Œæˆåï¼ŒDMA ç£ç›˜æ§åˆ¶å™¨ä¼šæ¥å—åˆ°ç£ç›˜çš„é€šçŸ¥ï¼Œå°†æ•°æ®ä»ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºæ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼›")]),e._v(" "),a("li",[e._v("DMA ç£ç›˜æ§åˆ¶å™¨å‘ CPU å‘å‡ºæ•°æ®è¯»å®Œçš„ä¿¡å·ï¼Œç”± CPU è´Ÿè´£å°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼›")]),e._v(" "),a("li",[e._v("ç”¨æˆ·è¿›ç¨‹ç”±å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œè§£é™¤é˜»å¡çŠ¶æ€ï¼Œç„¶åç­‰å¾… CPU çš„ä¸‹ä¸€ä¸ªæ‰§è¡Œæ—¶é—´é’Ÿã€‚")])]),e._v(" "),a("h2",{attrs:{id:"ä¼ ç»Ÿ-i-o-å­˜åœ¨å“ªäº›é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¼ ç»Ÿ-i-o-å­˜åœ¨å“ªäº›é—®é¢˜"}},[e._v("ğŸ‹")]),e._v(" ä¼ ç»Ÿ I/O å­˜åœ¨å“ªäº›é—®é¢˜")]),e._v(" "),a("p",[e._v("åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¼ ç»Ÿçš„è®¿é—®æ–¹å¼æ˜¯é€šè¿‡ "),a("code",[e._v("write()")]),e._v(" å’Œ "),a("code",[e._v("read()")]),e._v(" ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å®ç°çš„ï¼Œé€šè¿‡ "),a("code",[e._v("read()")]),e._v(" å‡½æ•°è¯»å–æ–‡ä»¶åˆ°åˆ°ç¼“å­˜åŒºä¸­ï¼Œç„¶åé€šè¿‡ "),a("code",[e._v("write()")]),e._v("æ–¹æ³•æŠŠç¼“å­˜ä¸­çš„æ•°æ®è¾“å‡ºåˆ°ç½‘ç»œç«¯å£ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Copyread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("file_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" tmp_buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("socket_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" tmp_buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("å›¾åˆ†åˆ«å¯¹åº”ä¼ ç»Ÿ I/O æ“ä½œçš„æ•°æ®è¯»å†™æµç¨‹ï¼Œæ•´ä¸ªè¿‡ç¨‹æ¶‰åŠ 2 æ¬¡ CPU æ‹·è´ã€2 æ¬¡ DMA æ‹·è´æ€»å…± 4 æ¬¡æ‹·è´ï¼Œä»¥åŠ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸‹é¢ç®€å•åœ°é˜è¿°ä¸€ä¸‹ç›¸å…³çš„æ¦‚å¿µã€‚")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy3.png",alt:"6"}})]),e._v(" "),a("p",[e._v("å…³é”®åè¯è§£é‡Šï¼š")]),e._v(" "),a("p",[a("strong",[e._v("ä¸Šä¸‹æ–‡åˆ‡æ¢")]),e._v("ï¼šå½“ç”¨æˆ·ç¨‹åºå‘å†…æ ¸å‘èµ·ç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒCPU å°†ç”¨æˆ·è¿›ç¨‹ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼›å½“ç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶ï¼ŒCPU å°†ç”¨æˆ·è¿›ç¨‹ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ã€‚")]),e._v(" "),a("p",[a("strong",[e._v("CPU æ‹·è´")]),e._v("ï¼šç”± CPU ç›´æ¥å¤„ç†æ•°æ®çš„ä¼ é€ï¼Œæ•°æ®æ‹·è´æ—¶ä¼šä¸€ç›´å ç”¨ CPU çš„èµ„æºã€‚")]),e._v(" "),a("p",[a("strong",[e._v("DMA æ‹·è´")]),e._v("ï¼šç”± CPU å‘ DMA ç£ç›˜æ§åˆ¶å™¨ä¸‹è¾¾æŒ‡ä»¤ï¼Œè®© DMA æ§åˆ¶å™¨æ¥å¤„ç†æ•°æ®çš„ä¼ é€ï¼Œæ•°æ®ä¼ é€å®Œæ¯•å†æŠŠä¿¡æ¯åé¦ˆç»™ CPUï¼Œä»è€Œå‡è½»äº† CPU èµ„æºçš„å æœ‰ç‡ã€‚")]),e._v(" "),a("p",[e._v("å½“åº”ç”¨ç¨‹åºæ‰§è¡Œ read ç³»ç»Ÿè°ƒç”¨è¯»å–ä¸€å—æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœè¿™å—æ•°æ®å·²ç»å­˜åœ¨äºç”¨æˆ·è¿›ç¨‹çš„é¡µå†…å­˜ä¸­ï¼Œå°±ç›´æ¥ä»å†…å­˜ä¸­è¯»å–æ•°æ®ï¼›å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™å…ˆå°†æ•°æ®ä»ç£ç›˜åŠ è½½æ•°æ®åˆ°å†…æ ¸ç©ºé—´çš„è¯»ç¼“å­˜(read buffer)ä¸­ï¼Œå†ä»è¯»ç¼“å­˜æ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹çš„é¡µå†…å­˜ä¸­ã€‚")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Copyread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("file_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" tmp_buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("åŸºäºä¼ ç»Ÿçš„ I/O è¯»å–æ–¹å¼ï¼Œread ç³»ç»Ÿè°ƒç”¨ä¼šè§¦å‘ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ1 æ¬¡ DMA æ‹·è´å’Œ 1 æ¬¡ CPU æ‹·è´ï¼Œå‘èµ·æ•°æ®è¯»å–çš„æµç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹é€šè¿‡"),a("code",[e._v("read()")]),e._v("å‡½æ•°å‘å†…æ ¸ (kernel) å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€ (user space) åˆ‡æ¢ä¸ºå†…æ ¸æ€ (kernel space)ï¼›")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ä¸»å­˜æˆ–ç¡¬ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ (kernel space) çš„è¯»ç¼“å†²åŒº (read buffer)ï¼›")]),e._v(" "),a("li",[e._v("CPU å°†è¯»ç¼“å†²åŒº (read buffer) ä¸­çš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ (user space) çš„ç”¨æˆ·ç¼“å†²åŒº (user buffer)ã€‚")]),e._v(" "),a("li",[e._v("ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€ (kernel space) åˆ‡æ¢å›ç”¨æˆ·æ€ (user space)ï¼Œread è°ƒç”¨æ‰§è¡Œè¿”å›ã€‚")])]),e._v(" "),a("h3",{attrs:{id:"ä¼ ç»Ÿå†™æ“ä½œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¼ ç»Ÿå†™æ“ä½œ"}},[e._v("ğŸ‹")]),e._v(" ä¼ ç»Ÿå†™æ“ä½œ")]),e._v(" "),a("p",[e._v("å½“åº”ç”¨ç¨‹åºå‡†å¤‡å¥½æ•°æ®ï¼Œæ‰§è¡Œ write ç³»ç»Ÿè°ƒç”¨å‘é€ç½‘ç»œæ•°æ®æ—¶ï¼Œå…ˆå°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´çš„é¡µç¼“å­˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„ç½‘ç»œç¼“å†²åŒº(socket buffer)ä¸­ï¼Œç„¶åå†å°†å†™ç¼“å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°ç½‘å¡è®¾å¤‡å®Œæˆæ•°æ®å‘é€ã€‚")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Copywrite")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("socket_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" tmp_buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("åŸºäºä¼ ç»Ÿçš„ I/O å†™å…¥æ–¹å¼ï¼Œ"),a("code",[e._v("write()")]),e._v(" ç³»ç»Ÿè°ƒç”¨ä¼šè§¦å‘ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ1 æ¬¡ CPU æ‹·è´å’Œ 1 æ¬¡ DMA æ‹·è´ï¼Œç”¨æˆ·ç¨‹åºå‘é€ç½‘ç»œæ•°æ®çš„æµç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹é€šè¿‡ "),a("code",[e._v("write()")]),e._v(" å‡½æ•°å‘å†…æ ¸ (kernel) å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€ (user space) åˆ‡æ¢ä¸ºå†…æ ¸æ€(kernel space)ã€‚")]),e._v(" "),a("li",[e._v("CPU å°†ç”¨æˆ·ç¼“å†²åŒº (user buffer) ä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç©ºé—´ (kernel space) çš„ç½‘ç»œç¼“å†²åŒº (socket buffer)ã€‚")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ç½‘ç»œç¼“å†²åŒº (socket buffer) æ‹·è´åˆ°ç½‘å¡è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚")]),e._v(" "),a("li",[e._v("ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€ (kernel space) åˆ‡æ¢å›ç”¨æˆ·æ€ (user space)ï¼Œwrite ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿”å›ã€‚")])]),e._v(" "),a("h3",{attrs:{id:"é›¶æ‹·è´æ–¹å¼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é›¶æ‹·è´æ–¹å¼"}},[e._v("ğŸ‹")]),e._v(" é›¶æ‹·è´æ–¹å¼")]),e._v(" "),a("p",[e._v("åœ¨ Linux ä¸­é›¶æ‹·è´æŠ€æœ¯ä¸»è¦æœ‰ 3 ä¸ªå®ç°æ€è·¯ï¼šç”¨æˆ·æ€ç›´æ¥ I/Oã€å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ä»¥åŠå†™æ—¶å¤åˆ¶æŠ€æœ¯ã€‚")]),e._v(" "),a("ul",[a("li",[e._v("ç”¨æˆ·æ€ç›´æ¥ I/Oï¼šåº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®ç¡¬ä»¶å­˜å‚¨ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸åªæ˜¯è¾…åŠ©æ•°æ®ä¼ è¾“ã€‚è¿™ç§æ–¹å¼ä¾æ—§å­˜åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç¡¬ä»¶ä¸Šçš„æ•°æ®ç›´æ¥æ‹·è´è‡³äº†ç”¨æˆ·ç©ºé—´ï¼Œä¸ç»è¿‡å†…æ ¸ç©ºé—´ã€‚å› æ­¤ï¼Œç›´æ¥ I/O ä¸å­˜åœ¨å†…æ ¸ç©ºé—´ç¼“å†²åŒºå’Œç”¨æˆ·ç©ºé—´ç¼“å†²åŒºä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚")]),e._v(" "),a("li",[e._v("å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼šåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œé¿å…æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºå’Œç³»ç»Ÿå†…æ ¸ç©ºé—´ç¼“å†²åŒºä¹‹é—´çš„CPUæ‹·è´ï¼Œä»¥åŠæ•°æ®åœ¨ç³»ç»Ÿå†…æ ¸ç©ºé—´å†…çš„CPUæ‹·è´ï¼Œè¿™ä¹Ÿæ˜¯å½“å‰ä¸»æµé›¶æ‹·è´æŠ€æœ¯çš„å®ç°æ€è·¯ã€‚")]),e._v(" "),a("li",[e._v("å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼šå†™æ—¶å¤åˆ¶æŒ‡çš„æ˜¯å½“å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€å—æ•°æ®æ—¶ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¿›ç¨‹éœ€è¦å¯¹è¿™ä»½æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆå°†å…¶æ‹·è´åˆ°è‡ªå·±çš„è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œå¦‚æœåªæ˜¯æ•°æ®è¯»å–æ“ä½œåˆ™ä¸éœ€è¦è¿›è¡Œæ‹·è´æ“ä½œã€‚")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy4.png",alt:"13"}})]),e._v(" "),a("h4",{attrs:{id:"ç”¨æˆ·æ€ç›´æ¥-i-o"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨æˆ·æ€ç›´æ¥-i-o"}},[e._v("ğŸ‹")]),e._v(" ç”¨æˆ·æ€ç›´æ¥ I/O")]),e._v(" "),a("p",[e._v("ç”¨æˆ·æ€ç›´æ¥ I/O ä½¿å¾—åº”ç”¨è¿›ç¨‹æˆ–è¿è¡Œåœ¨ç”¨æˆ·æ€(user space)ä¸‹çš„åº“å‡½æ•°ç›´æ¥è®¿é—®ç¡¬ä»¶è®¾å¤‡ï¼Œæ•°æ®ç›´æ¥è·¨è¿‡å†…æ ¸è¿›è¡Œä¼ è¾“ï¼Œå†…æ ¸åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹é™¤äº†è¿›è¡Œå¿…è¦çš„è™šæ‹Ÿå­˜å‚¨é…ç½®å·¥ä½œä¹‹å¤–ï¼Œä¸å‚ä¸ä»»ä½•å…¶ä»–å·¥ä½œï¼Œè¿™ç§æ–¹å¼èƒ½å¤Ÿç›´æ¥ç»•è¿‡å†…æ ¸ï¼Œæå¤§æé«˜äº†æ€§èƒ½ã€‚")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy5.png",alt:"7"}})]),e._v(" "),a("p",[e._v("ç¼ºç‚¹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("è¿™ç§æ–¹æ³•åªèƒ½é€‚ç”¨äºé‚£äº›ä¸éœ€è¦å†…æ ¸ç¼“å†²åŒºå¤„ç†çš„åº”ç”¨ç¨‹åºï¼Œè¿™äº›åº”ç”¨ç¨‹åºé€šå¸¸åœ¨è¿›ç¨‹åœ°å€ç©ºé—´æœ‰è‡ªå·±çš„æ•°æ®ç¼“å­˜æœºåˆ¶ï¼Œç§°ä¸ºè‡ªç¼“å­˜åº”ç”¨ç¨‹åºï¼Œå¦‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªä»£è¡¨ã€‚")]),e._v(" "),a("li",[e._v("è¿™ç§æ–¹æ³•ç›´æ¥æ“ä½œç£ç›˜ I/Oï¼Œç”±äº CPU å’Œç£ç›˜ I/O ä¹‹é—´çš„æ‰§è¡Œæ—¶é—´å·®è·ï¼Œä¼šé€ æˆèµ„æºçš„æµªè´¹ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦å’Œå¼‚æ­¥ I/O ç»“åˆä½¿ç”¨ã€‚")])]),e._v(" "),a("h4",{attrs:{id:"mmap-write"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mmap-write"}},[e._v("ğŸ‹")]),e._v(" mmap + write")]),e._v(" "),a("p",[e._v("ä¸€ç§é›¶æ‹·è´æ–¹å¼æ˜¯ä½¿ç”¨ mmap + write ä»£æ›¿åŸæ¥çš„ read + write æ–¹å¼ï¼Œå‡å°‘äº† 1 æ¬¡ CPU æ‹·è´æ“ä½œã€‚mmap æ˜¯ Linux æä¾›çš„ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶æ–¹æ³•ï¼Œå³å°†ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­çš„ä¸€æ®µè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç£ç›˜æ–‡ä»¶åœ°å€ï¼Œmmap + write çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[e._v("Copytmp_buf "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mmap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("file_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("socket_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" tmp_buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("ä½¿ç”¨ mmap çš„ç›®çš„æ˜¯å°†å†…æ ¸ä¸­è¯»ç¼“å†²åŒº(read buffer)çš„åœ°å€ä¸ç”¨æˆ·ç©ºé—´çš„ç¼“å†²åŒº(user buffer)è¿›è¡Œæ˜ å°„ï¼Œä»è€Œå®ç°å†…æ ¸ç¼“å†²åŒºä¸åº”ç”¨ç¨‹åºå†…å­˜çš„å…±äº«ï¼Œçœå»äº†å°†æ•°æ®ä»å†…æ ¸è¯»ç¼“å†²åŒº(read buffer)æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒº(user buffer)çš„è¿‡ç¨‹ï¼Œç„¶è€Œå†…æ ¸è¯»ç¼“å†²åŒº(read buffer)ä»éœ€å°†æ•°æ®åˆ°å†…æ ¸å†™ç¼“å†²åŒº(socket buffer)ï¼Œå¤§è‡´çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy6.png",alt:"8"}})]),e._v(" "),a("p",[e._v("åŸºäº mmap + write ç³»ç»Ÿè°ƒç”¨çš„é›¶æ‹·è´æ–¹å¼ï¼Œæ•´ä¸ªæ‹·è´è¿‡ç¨‹ä¼šå‘ç”Ÿ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ1 æ¬¡ CPU æ‹·è´å’Œ 2 æ¬¡ DMA æ‹·è´ï¼Œç”¨æˆ·ç¨‹åºè¯»å†™æ•°æ®çš„æµç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹é€šè¿‡ "),a("code",[e._v("mmap()")]),e._v(" å‡½æ•°å‘å†…æ ¸ (kernel) å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€ (user space) åˆ‡æ¢ä¸ºå†…æ ¸æ€(kernel space)ï¼›")]),e._v(" "),a("li",[e._v("å°†ç”¨æˆ·è¿›ç¨‹çš„å†…æ ¸ç©ºé—´çš„è¯»ç¼“å†²åŒº (read buffer) ä¸ç”¨æˆ·ç©ºé—´çš„ç¼“å­˜åŒº (user buffer) è¿›è¡Œå†…å­˜åœ°å€æ˜ å°„ï¼›")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ä¸»å­˜æˆ–ç¡¬ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ (kernel space) çš„è¯»ç¼“å†²åŒº (read buffer)ï¼›")]),e._v(" "),a("li",[e._v("ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€ (kernel space) åˆ‡æ¢å›ç”¨æˆ·æ€ (user space)ï¼Œmmap ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿”å›ï¼›")]),e._v(" "),a("li",[e._v("ç”¨æˆ·è¿›ç¨‹é€šè¿‡"),a("code",[e._v("write()")]),e._v(" å‡½æ•°å‘å†…æ ¸ (kernel) å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€ (user space) åˆ‡æ¢ä¸ºå†…æ ¸æ€(kernel space)ï¼›")]),e._v(" "),a("li",[e._v("CPU å°†è¯»ç¼“å†²åŒº (read buffer) ä¸­çš„æ•°æ®æ‹·è´åˆ°çš„ç½‘ç»œç¼“å†²åŒº (socket buffer) ï¼›")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ç½‘ç»œç¼“å†²åŒº (socket buffer) æ‹·è´åˆ°ç½‘å¡è¿›è¡Œæ•°æ®ä¼ è¾“ï¼›")]),e._v(" "),a("li",[e._v("ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€ (kernel space) åˆ‡æ¢å›ç”¨æˆ·æ€ (user space) ï¼Œwrite ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿”å›ï¼›")])]),e._v(" "),a("p",[e._v("ç¼ºé™·ï¼š")]),e._v(" "),a("p",[e._v("mmap ä¸»è¦çš„ç”¨å¤„æ˜¯æé«˜ I/O æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹å¤§æ–‡ä»¶ã€‚å¯¹äºå°æ–‡ä»¶ï¼Œå†…å­˜æ˜ å°„æ–‡ä»¶åè€Œä¼šå¯¼è‡´ç¢ç‰‡ç©ºé—´çš„æµªè´¹ï¼Œå› ä¸ºå†…å­˜æ˜ å°„æ€»æ˜¯è¦å¯¹é½é¡µè¾¹ç•Œï¼Œæœ€å°å•ä½æ˜¯ 4 KBï¼Œä¸€ä¸ª 5 KB çš„æ–‡ä»¶å°†ä¼šæ˜ å°„å ç”¨ 8 KB å†…å­˜ï¼Œä¹Ÿå°±ä¼šæµªè´¹ 3 KB å†…å­˜ã€‚")]),e._v(" "),a("p",[e._v("å¦å¤– mmap éšè—ç€ä¸€ä¸ªé™·é˜±ï¼Œå½“ä½¿ç”¨ mmap æ˜ å°„ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶è¢«å¦ä¸€ä¸ªè¿›ç¨‹æ‰€æˆªè·ï¼Œé‚£ä¹ˆ write ç³»ç»Ÿè°ƒç”¨ä¼šå› ä¸ºè®¿é—®éæ³•åœ°å€è¢« SIGBUS ä¿¡å·ç»ˆæ­¢ï¼ŒSIGBUS é»˜è®¤ä¼šæ€æ­»è¿›ç¨‹å¹¶äº§ç”Ÿä¸€ä¸ª coredumpï¼Œå¦‚æœæœåŠ¡å™¨è¢«è¿™æ ·ç»ˆæ­¢é‚£æŸå¤±å°±å¯èƒ½ä¸å°ã€‚")]),e._v(" "),a("p",[e._v("è§£å†³è¿™ä¸ªé—®é¢˜é€šå¸¸ä½¿ç”¨æ–‡ä»¶çš„ç§Ÿå€Ÿé”ï¼šé¦–å…ˆä¸ºæ–‡ä»¶ç”³è¯·ä¸€ä¸ªç§Ÿå€Ÿé”ï¼Œå½“å…¶ä»–è¿›ç¨‹æƒ³è¦æˆªæ–­è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šå‘é€ä¸€ä¸ªå®æ—¶çš„ "),a("code",[e._v("RT_SIGNAL_LEASE")]),e._v(" ä¿¡å·ï¼Œå‘Šè¯‰å½“å‰è¿›ç¨‹æœ‰è¿›ç¨‹åœ¨è¯•å›¾ç ´åæ–‡ä»¶ï¼Œè¿™æ · write åœ¨è¢« SIGBUS æ€æ­»ä¹‹å‰ï¼Œä¼šè¢«ä¸­æ–­ï¼Œè¿”å›å·²ç»å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¹¶è®¾ç½® errno ä¸º successã€‚")]),e._v(" "),a("p",[e._v("é€šå¸¸çš„åšæ³•æ˜¯åœ¨ mmap ä¹‹å‰åŠ é”ï¼Œæ“ä½œå®Œä¹‹åè§£é”ã€‚")]),e._v(" "),a("h4",{attrs:{id:"sendfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendfile"}},[e._v("ğŸ‹")]),e._v(" sendfile")]),e._v(" "),a("p",[e._v("sendfile ç³»ç»Ÿè°ƒç”¨åœ¨ Linux å†…æ ¸ç‰ˆæœ¬ 2.1 ä¸­è¢«å¼•å…¥ï¼Œç›®çš„æ˜¯ç®€åŒ–é€šè¿‡ç½‘ç»œåœ¨ä¸¤ä¸ªé€šé“ä¹‹é—´è¿›è¡Œçš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚sendfile ç³»ç»Ÿè°ƒç”¨çš„å¼•å…¥ï¼Œä¸ä»…å‡å°‘äº† CPU æ‹·è´çš„æ¬¡æ•°ï¼Œè¿˜å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ï¼Œå®ƒçš„ä¼ªä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Copysendfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("socket_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" file_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("é€šè¿‡ sendfile ç³»ç»Ÿè°ƒç”¨ï¼Œæ•°æ®å¯ä»¥ç›´æ¥åœ¨å†…æ ¸ç©ºé—´å†…éƒ¨è¿›è¡Œ I/O ä¼ è¾“ï¼Œä»è€Œçœå»äº†æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ¥å›æ‹·è´ã€‚ä¸ mmap å†…å­˜æ˜ å°„æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œ sendfile è°ƒç”¨ä¸­ I/O æ•°æ®å¯¹ç”¨æˆ·ç©ºé—´æ˜¯å®Œå…¨ä¸å¯è§çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€æ¬¡å®Œå…¨æ„ä¹‰ä¸Šçš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy7.png",alt:"9"}})]),e._v(" "),a("p",[e._v("åŸºäº sendfile ç³»ç»Ÿè°ƒç”¨çš„é›¶æ‹·è´æ–¹å¼ï¼Œæ•´ä¸ªæ‹·è´è¿‡ç¨‹ä¼šå‘ç”Ÿ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ1 æ¬¡ CPU æ‹·è´å’Œ 2 æ¬¡ DMA æ‹·è´ï¼Œç”¨æˆ·ç¨‹åºè¯»å†™æ•°æ®çš„æµç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹é€šè¿‡ "),a("code",[e._v("sendfile()")]),e._v(" å‡½æ•°å‘å†…æ ¸ (kernel) å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€ (user space) åˆ‡æ¢ä¸ºå†…æ ¸æ€(kernel space)ã€‚")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ä¸»å­˜æˆ–ç¡¬ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ (kernel space) çš„è¯»ç¼“å†²åŒº (read buffer)ã€‚")]),e._v(" "),a("li",[e._v("CPU å°†è¯»ç¼“å†²åŒº (read buffer) ä¸­çš„æ•°æ®æ‹·è´åˆ°çš„ç½‘ç»œç¼“å†²åŒº (socket buffer)ã€‚")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ç½‘ç»œç¼“å†²åŒº (socket buffer) æ‹·è´åˆ°ç½‘å¡è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚")]),e._v(" "),a("li",[e._v("ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€ (kernel space) åˆ‡æ¢å›ç”¨æˆ·æ€ (user space)ï¼Œsendfile ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿”å›ã€‚")])]),e._v(" "),a("p",[e._v("ç›¸æ¯”è¾ƒäº mmap å†…å­˜æ˜ å°„çš„æ–¹å¼ï¼Œsendfile å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ˜¯ä»ç„¶æœ‰ 1 æ¬¡ CPU æ‹·è´æ“ä½œã€‚sendfile å­˜åœ¨çš„é—®é¢˜æ˜¯ç”¨æˆ·ç¨‹åºä¸èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè€Œåªæ˜¯å•çº¯åœ°å®Œæˆäº†ä¸€æ¬¡æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚")]),e._v(" "),a("p",[e._v("ç¼ºç‚¹ï¼š")]),e._v(" "),a("p",[e._v("åªèƒ½é€‚ç”¨äºé‚£äº›ä¸éœ€è¦ç”¨æˆ·æ€å¤„ç†çš„åº”ç”¨ç¨‹åºã€‚")]),e._v(" "),a("h4",{attrs:{id:"sendfile-dma-gather-copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendfile-dma-gather-copy"}},[e._v("ğŸ‹")]),e._v(" sendfile + DMA gather copy")]),e._v(" "),a("p",[e._v("å¸¸è§„ sendfile è¿˜æœ‰ä¸€æ¬¡å†…æ ¸æ€çš„æ‹·è´æ“ä½œï¼Œèƒ½ä¸èƒ½ä¹ŸæŠŠè¿™æ¬¡æ‹·è´ç»™å»æ‰å‘¢ï¼Ÿ")]),e._v(" "),a("p",[e._v("ç­”æ¡ˆå°±æ˜¯è¿™ç§ DMA è¾…åŠ©çš„ sendfileã€‚")]),e._v(" "),a("p",[e._v("Linux 2.4 ç‰ˆæœ¬çš„å†…æ ¸å¯¹ sendfile ç³»ç»Ÿè°ƒç”¨è¿›è¡Œä¿®æ”¹ï¼Œä¸º DMA æ‹·è´å¼•å…¥äº† gather æ“ä½œã€‚å®ƒå°†å†…æ ¸ç©ºé—´ (kernel space) çš„è¯»ç¼“å†²åŒº (read buffer) ä¸­å¯¹åº”çš„æ•°æ®æè¿°ä¿¡æ¯ (å†…å­˜åœ°å€ã€åœ°å€åç§»é‡) è®°å½•åˆ°ç›¸åº”çš„ç½‘ç»œç¼“å†²åŒº( (socket buffer) ä¸­ï¼Œç”± DMA æ ¹æ®å†…å­˜åœ°å€ã€åœ°å€åç§»é‡å°†æ•°æ®æ‰¹é‡åœ°ä»è¯»ç¼“å†²åŒº (read buffer) æ‹·è´åˆ°ç½‘å¡è®¾å¤‡ä¸­ï¼Œè¿™æ ·å°±çœå»äº†å†…æ ¸ç©ºé—´ä¸­ä»…å‰©çš„ 1 æ¬¡ CPU æ‹·è´æ“ä½œï¼Œsendfile çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Copysendfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("socket_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" file_fd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("åœ¨ç¡¬ä»¶çš„æ”¯æŒä¸‹ï¼Œsendfile æ‹·è´æ–¹å¼ä¸å†ä»å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºï¼Œå–è€Œä»£ä¹‹çš„ä»…ä»…æ˜¯ç¼“å†²åŒºæ–‡ä»¶æè¿°ç¬¦å’Œæ•°æ®é•¿åº¦çš„æ‹·è´ï¼Œè¿™æ · DMA å¼•æ“ç›´æ¥åˆ©ç”¨ gather æ“ä½œå°†é¡µç¼“å­˜ä¸­æ•°æ®æ‰“åŒ…å‘é€åˆ°ç½‘ç»œä¸­å³å¯ï¼Œæœ¬è´¨å°±æ˜¯å’Œè™šæ‹Ÿå†…å­˜æ˜ å°„çš„æ€è·¯ç±»ä¼¼ã€‚")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy8.png",alt:"10"}})]),e._v(" "),a("p",[e._v("åŸºäº sendfile + DMA gather copy ç³»ç»Ÿè°ƒç”¨çš„é›¶æ‹·è´æ–¹å¼ï¼Œæ•´ä¸ªæ‹·è´è¿‡ç¨‹ä¼šå‘ç”Ÿ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€0 æ¬¡ CPU æ‹·è´ä»¥åŠ 2 æ¬¡ DMA æ‹·è´ï¼Œç”¨æˆ·ç¨‹åºè¯»å†™æ•°æ®çš„æµç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹é€šè¿‡ "),a("code",[e._v("sendfile()")]),e._v("å‡½æ•°å‘å†…æ ¸ (kernel) å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€ (user space) åˆ‡æ¢ä¸ºå†…æ ¸æ€(kernel space)ã€‚")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ä¸»å­˜æˆ–ç¡¬ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ (kernel space) çš„è¯»ç¼“å†²åŒº (read buffer)ã€‚")]),e._v(" "),a("li",[e._v("CPU æŠŠè¯»ç¼“å†²åŒº (read buffer) çš„æ–‡ä»¶æè¿°ç¬¦(file descriptor)å’Œæ•°æ®é•¿åº¦æ‹·è´åˆ°ç½‘ç»œç¼“å†²åŒº(socket buffer)ã€‚")]),e._v(" "),a("li",[e._v("åŸºäºå·²æ‹·è´çš„æ–‡ä»¶æè¿°ç¬¦ (file descriptor) å’Œæ•°æ®é•¿åº¦ï¼ŒCPU åˆ©ç”¨ DMA æ§åˆ¶å™¨çš„ gather/scatter æ“ä½œç›´æ¥æ‰¹é‡åœ°å°†æ•°æ®ä»å†…æ ¸çš„è¯»ç¼“å†²åŒº (read buffer) æ‹·è´åˆ°ç½‘å¡è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚")]),e._v(" "),a("li",[e._v("ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€ (kernel space) åˆ‡æ¢å›ç”¨æˆ·æ€ (user space)ï¼Œsendfile ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿”å›ã€‚")])]),e._v(" "),a("p",[e._v("sendfile + DMA gather copy æ‹·è´æ–¹å¼åŒæ ·å­˜åœ¨ç”¨æˆ·ç¨‹åºä¸èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„é—®é¢˜ï¼Œè€Œä¸”æœ¬èº«éœ€è¦ç¡¬ä»¶çš„æ”¯æŒï¼Œå®ƒåªé€‚ç”¨äºå°†æ•°æ®ä»æ–‡ä»¶æ‹·è´åˆ° socket å¥—æ¥å­—ä¸Šçš„ä¼ è¾“è¿‡ç¨‹ã€‚")]),e._v(" "),a("h4",{attrs:{id:"splice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#splice"}},[e._v("ğŸ‹")]),e._v(" splice")]),e._v(" "),a("p",[e._v("sendfile åªé€‚ç”¨äºå°†æ•°æ®ä»æ–‡ä»¶æ‹·è´åˆ° socket å¥—æ¥å­—ä¸Šï¼ŒåŒæ—¶éœ€è¦ç¡¬ä»¶çš„æ”¯æŒï¼Œè¿™ä¹Ÿé™å®šäº†å®ƒçš„ä½¿ç”¨èŒƒå›´ã€‚Linux åœ¨ 2.6.17 ç‰ˆæœ¬å¼•å…¥ splice ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ä»…ä¸éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œè¿˜å®ç°äº†ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´çš„æ•°æ®é›¶æ‹·è´ã€‚splice çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),a("div",{staticClass:"language-ccp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Copysplice(fd_in, off_in, fd_out, off_out, len, flags);\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("splice ç³»ç»Ÿè°ƒç”¨å¯ä»¥åœ¨å†…æ ¸ç©ºé—´çš„è¯»ç¼“å†²åŒº (read buffer) å’Œç½‘ç»œç¼“å†²åŒº (socket buffer) ä¹‹é—´å»ºç«‹ç®¡é“ (pipeline)ï¼Œä»è€Œé¿å…äº†ä¸¤è€…ä¹‹é—´çš„ CPU æ‹·è´æ“ä½œã€‚")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy9.png",alt:"11"}})]),e._v(" "),a("p",[e._v("åŸºäº splice ç³»ç»Ÿè°ƒç”¨çš„é›¶æ‹·è´æ–¹å¼ï¼Œæ•´ä¸ªæ‹·è´è¿‡ç¨‹ä¼šå‘ç”Ÿ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ0 æ¬¡ CPU æ‹·è´ä»¥åŠ 2 æ¬¡ DMA æ‹·è´ï¼Œç”¨æˆ·ç¨‹åºè¯»å†™æ•°æ®çš„æµç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),a("ol",[a("li",[e._v("ç”¨æˆ·è¿›ç¨‹é€šè¿‡ "),a("code",[e._v("splice()")]),e._v(" å‡½æ•°å‘å†…æ ¸(kernel)å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€ (user space) åˆ‡æ¢ä¸ºå†…æ ¸æ€(kernel space)ï¼›")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ä¸»å­˜æˆ–ç¡¬ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ (kernel space) çš„è¯»ç¼“å†²åŒº (read buffer)ï¼›")]),e._v(" "),a("li",[e._v("CPU åœ¨å†…æ ¸ç©ºé—´çš„è¯»ç¼“å†²åŒº (read buffer) å’Œç½‘ç»œç¼“å†²åŒº(socket buffer)ä¹‹é—´å»ºç«‹ç®¡é“ (pipeline)ï¼›")]),e._v(" "),a("li",[e._v("CPU åˆ©ç”¨ DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ç½‘ç»œç¼“å†²åŒº (socket buffer) æ‹·è´åˆ°ç½‘å¡è¿›è¡Œæ•°æ®ä¼ è¾“ï¼›")]),e._v(" "),a("li",[e._v("ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€ (kernel space) åˆ‡æ¢å›ç”¨æˆ·æ€ (user space)ï¼Œsplice ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿”å›ã€‚")])]),e._v(" "),a("p",[e._v("splice æ‹·è´æ–¹å¼ä¹ŸåŒæ ·å­˜åœ¨ç”¨æˆ·ç¨‹åºä¸èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä½¿ç”¨äº† Linux çš„ç®¡é“ç¼“å†²æœºåˆ¶ï¼Œå¯ä»¥ç”¨äºä»»æ„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸­ä¼ è¾“æ•°æ®ï¼Œä½†æ˜¯å®ƒçš„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å‚æ•°ä¸­æœ‰ä¸€ä¸ªå¿…é¡»æ˜¯ç®¡é“è®¾å¤‡ã€‚")]),e._v(" "),a("h4",{attrs:{id:"å†™æ—¶å¤åˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å†™æ—¶å¤åˆ¶"}},[e._v("ğŸ‹")]),e._v(" å†™æ—¶å¤åˆ¶")]),e._v(" "),a("p",[e._v("åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå†…æ ¸ç¼“å†²åŒºå¯èƒ½è¢«å¤šä¸ªè¿›ç¨‹æ‰€å…±äº«ï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è¿™ä¸ªå…±äº«åŒºè¿›è¡Œ write æ“ä½œï¼Œç”±äº write ä¸æä¾›ä»»ä½•çš„é”æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å…±äº«åŒºä¸­çš„æ•°æ®é€ æˆç ´åï¼Œå†™æ—¶å¤åˆ¶çš„å¼•å…¥å°±æ˜¯ Linux ç”¨æ¥ä¿æŠ¤æ•°æ®çš„ã€‚")]),e._v(" "),a("p",[e._v("å†™æ—¶å¤åˆ¶æŒ‡çš„æ˜¯å½“å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€å—æ•°æ®æ—¶ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¿›ç¨‹éœ€è¦å¯¹è¿™ä»½æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†å…¶æ‹·è´åˆ°è‡ªå·±çš„è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ã€‚è¿™æ ·åšå¹¶ä¸å½±å“å…¶ä»–è¿›ç¨‹å¯¹è¿™å—æ•°æ®çš„æ“ä½œï¼Œæ¯ä¸ªè¿›ç¨‹è¦ä¿®æ”¹çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ‹·è´ï¼Œæ‰€ä»¥å«å†™æ—¶æ‹·è´ã€‚è¿™ç§æ–¹æ³•åœ¨æŸç§ç¨‹åº¦ä¸Šèƒ½å¤Ÿé™ä½ç³»ç»Ÿå¼€é”€ï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹æ°¸è¿œä¸ä¼šå¯¹æ‰€è®¿é—®çš„æ•°æ®è¿›è¡Œæ›´æ”¹ï¼Œé‚£ä¹ˆä¹Ÿå°±æ°¸è¿œä¸éœ€è¦æ‹·è´ã€‚")]),e._v(" "),a("p",[e._v("ç¼ºç‚¹ï¼š")]),e._v(" "),a("p",[e._v("éœ€è¦ MMU çš„æ”¯æŒï¼ŒMMU éœ€è¦çŸ¥é“è¿›ç¨‹åœ°å€ç©ºé—´ä¸­å“ªäº›é¡µé¢æ˜¯åªè¯»çš„ï¼Œå½“éœ€è¦å¾€è¿™äº›é¡µé¢å†™æ•°æ®æ—¶ï¼Œå‘å‡ºä¸€ä¸ªå¼‚å¸¸ç»™æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå†…æ ¸ä¼šåˆ†é…æ–°çš„å­˜å‚¨ç©ºé—´æ¥ä¾›å†™å…¥çš„éœ€æ±‚ã€‚")]),e._v(" "),a("h4",{attrs:{id:"ç¼“å†²åŒºå…±äº«"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼“å†²åŒºå…±äº«"}},[e._v("ğŸ‹")]),e._v(" ç¼“å†²åŒºå…±äº«")]),e._v(" "),a("p",[e._v("ç¼“å†²åŒºå…±äº«æ–¹å¼å®Œå…¨æ”¹å†™äº†ä¼ ç»Ÿçš„ I/O æ“ä½œï¼Œä¼ ç»Ÿçš„ Linux I/O æ¥å£æ”¯æŒæ•°æ®åœ¨åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´å’Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´äº¤æ¢ï¼Œè¿™ç§äº¤æ¢æ“ä½œå¯¼è‡´æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦è¿›è¡Œæ‹·è´ã€‚")]),e._v(" "),a("p",[e._v("å¦‚æœé‡‡ç”¨ fbufs è¿™ç§æ–¹æ³•ï¼Œéœ€è¦äº¤æ¢çš„æ˜¯åŒ…å«æ•°æ®çš„ç¼“å†²åŒºï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†å¤šä½™çš„æ‹·è´æ“ä½œã€‚åº”ç”¨ç¨‹åºå°† fbuf ä¼ é€’ç»™æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œè¿™æ ·å°±èƒ½å‡å°‘ä¼ ç»Ÿçš„ write ç³»ç»Ÿè°ƒç”¨æ‰€äº§ç”Ÿçš„æ•°æ®æ‹·è´å¼€é”€ã€‚")]),e._v(" "),a("p",[e._v("åŒæ ·çš„åº”ç”¨ç¨‹åºé€šè¿‡ fbuf æ¥æ¥æ”¶æ•°æ®ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å‡å°‘ä¼ ç»Ÿ read ç³»ç»Ÿè°ƒç”¨æ‰€äº§ç”Ÿçš„æ•°æ®æ‹·è´å¼€é”€ã€‚")]),e._v(" "),a("p",[e._v("fbuf çš„æ€æƒ³æ˜¯æ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤ç€ä¸€ä¸ªç¼“å†²åŒºæ± ï¼Œè¿™ä¸ªç¼“å†²åŒºæ± èƒ½è¢«åŒæ—¶æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ (user space) å’Œå†…æ ¸æ€ (kernel space)ï¼Œå†…æ ¸å’Œç”¨æˆ·å…±äº«è¿™ä¸ªç¼“å†²åŒºæ± ï¼Œè¿™æ ·å°±é¿å…äº†ä¸€ç³»åˆ—çš„æ‹·è´æ“ä½œã€‚")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://pycrab.github.io/KeepJava/assets/media/jdk-io-file-copy10.png",alt:"12"}})]),e._v(" "),a("p",[e._v("ç¼ºç‚¹ï¼š")]),e._v(" "),a("p",[e._v("ç¼“å†²åŒºå…±äº«çš„éš¾åº¦åœ¨äºç®¡ç†å…±äº«ç¼“å†²åŒºæ± éœ€è¦åº”ç”¨ç¨‹åºã€ç½‘ç»œè½¯ä»¶ä»¥åŠè®¾å¤‡é©±åŠ¨ç¨‹åºä¹‹é—´çš„ç´§å¯†åˆä½œï¼Œè€Œä¸”å¦‚ä½•æ”¹å†™ API ç›®å‰è¿˜å¤„äºè¯•éªŒé˜¶æ®µå¹¶ä¸æˆç†Ÿã€‚")]),e._v(" "),a("h2",{attrs:{id:"linux-é›¶æ‹·è´å¯¹æ¯”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-é›¶æ‹·è´å¯¹æ¯”"}},[e._v("ğŸ‹")]),e._v(" Linux é›¶æ‹·è´å¯¹æ¯”")]),e._v(" "),a("p",[e._v("æ— è®ºæ˜¯ä¼ ç»Ÿ I/O æ‹·è´æ–¹å¼è¿˜æ˜¯å¼•å…¥é›¶æ‹·è´çš„æ–¹å¼ï¼Œ2 æ¬¡ DMA Copy æ˜¯éƒ½å°‘ä¸äº†çš„ï¼Œå› ä¸ºä¸¤æ¬¡ DMA éƒ½æ˜¯ä¾èµ–ç¡¬ä»¶å®Œæˆçš„ã€‚ä¸‹é¢ä» CPU æ‹·è´æ¬¡æ•°ã€DMA æ‹·è´æ¬¡æ•°ä»¥åŠç³»ç»Ÿè°ƒç”¨å‡ ä¸ªæ–¹é¢æ€»ç»“ä¸€ä¸‹å‡ ç§ I/O æ‹·è´æ–¹å¼çš„å·®åˆ«ï¼š")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("æ‹·è´æ–¹å¼")]),e._v(" "),a("th",{staticStyle:{"text-align":"center"}},[e._v("CPUæ‹·è´")]),e._v(" "),a("th",{staticStyle:{"text-align":"center"}},[e._v("DMAæ‹·è´")]),e._v(" "),a("th",{staticStyle:{"text-align":"center"}},[e._v("ç³»ç»Ÿè°ƒç”¨")]),e._v(" "),a("th",{staticStyle:{"text-align":"center"}},[e._v("ä¸Šä¸‹æ–‡åˆ‡æ¢")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("ä¼ ç»Ÿæ–¹å¼ (read + write)")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("read / write")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("4")])]),e._v(" "),a("tr",[a("td",[e._v("å†…å­˜æ˜ å°„ (mmap + write)")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("1")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("mmap / write")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("4")])]),e._v(" "),a("tr",[a("td",[e._v("sendfile")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("1")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("sendfile")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")])]),e._v(" "),a("tr",[a("td",[e._v("sendfile + DMA gather copy")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("0")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("sendfile")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")])]),e._v(" "),a("tr",[a("td",[e._v("splice")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("0")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("splice")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("2")])])])]),e._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[e._v("è½¬è½½")]),e._v(" "),a("p",[e._v("æœ¬æ–‡è½¬è½½è‡ªåšå®¢å›­ rickiyang "),a("a",{attrs:{href:"https://www.cnblogs.com/rickiyang/p/13265043.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("é›¶æ‹·è´(Zero-copy) æµ…æåŠå…¶åº”ç”¨"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);