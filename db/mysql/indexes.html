<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL 数据库索引 | KeepJava</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="MySQL 数据库索引">
    <meta name="keywords" content="MySQL 数据库，索引">
    <link rel="preload" href="/KeepJava/assets/css/0.styles.0321c629.css" as="style"><link rel="preload" href="/KeepJava/assets/js/app.95e4ac80.js" as="script"><link rel="preload" href="/KeepJava/assets/js/2.73d6ef14.js" as="script"><link rel="preload" href="/KeepJava/assets/js/10.f77a3b1c.js" as="script"><link rel="prefetch" href="/KeepJava/assets/js/11.f2c39f13.js"><link rel="prefetch" href="/KeepJava/assets/js/12.7295ba16.js"><link rel="prefetch" href="/KeepJava/assets/js/13.cc733961.js"><link rel="prefetch" href="/KeepJava/assets/js/14.c0a99400.js"><link rel="prefetch" href="/KeepJava/assets/js/15.e38b5c52.js"><link rel="prefetch" href="/KeepJava/assets/js/16.8118b0f3.js"><link rel="prefetch" href="/KeepJava/assets/js/17.8a8fe6dc.js"><link rel="prefetch" href="/KeepJava/assets/js/18.6432444b.js"><link rel="prefetch" href="/KeepJava/assets/js/19.a3be88a3.js"><link rel="prefetch" href="/KeepJava/assets/js/20.c5e50ea4.js"><link rel="prefetch" href="/KeepJava/assets/js/21.964f1dfe.js"><link rel="prefetch" href="/KeepJava/assets/js/22.0dcbf95f.js"><link rel="prefetch" href="/KeepJava/assets/js/23.ced2e82f.js"><link rel="prefetch" href="/KeepJava/assets/js/24.6351a6c5.js"><link rel="prefetch" href="/KeepJava/assets/js/25.3cc78923.js"><link rel="prefetch" href="/KeepJava/assets/js/26.87ab7653.js"><link rel="prefetch" href="/KeepJava/assets/js/27.ebe07d00.js"><link rel="prefetch" href="/KeepJava/assets/js/28.e32b4030.js"><link rel="prefetch" href="/KeepJava/assets/js/29.a39dc7ab.js"><link rel="prefetch" href="/KeepJava/assets/js/3.596aa5f2.js"><link rel="prefetch" href="/KeepJava/assets/js/30.a7ef1e11.js"><link rel="prefetch" href="/KeepJava/assets/js/31.386e222b.js"><link rel="prefetch" href="/KeepJava/assets/js/32.85324444.js"><link rel="prefetch" href="/KeepJava/assets/js/33.1775ff36.js"><link rel="prefetch" href="/KeepJava/assets/js/34.e9f2b7c9.js"><link rel="prefetch" href="/KeepJava/assets/js/35.4b7e161f.js"><link rel="prefetch" href="/KeepJava/assets/js/36.39e8eff2.js"><link rel="prefetch" href="/KeepJava/assets/js/37.90259285.js"><link rel="prefetch" href="/KeepJava/assets/js/38.d838dba8.js"><link rel="prefetch" href="/KeepJava/assets/js/39.aab402f0.js"><link rel="prefetch" href="/KeepJava/assets/js/4.a6f55f5d.js"><link rel="prefetch" href="/KeepJava/assets/js/40.1e1951fb.js"><link rel="prefetch" href="/KeepJava/assets/js/41.b994974d.js"><link rel="prefetch" href="/KeepJava/assets/js/42.77236de4.js"><link rel="prefetch" href="/KeepJava/assets/js/43.f1cd7a56.js"><link rel="prefetch" href="/KeepJava/assets/js/44.b9cf68c3.js"><link rel="prefetch" href="/KeepJava/assets/js/45.d949d581.js"><link rel="prefetch" href="/KeepJava/assets/js/46.3306095e.js"><link rel="prefetch" href="/KeepJava/assets/js/47.1c08e86c.js"><link rel="prefetch" href="/KeepJava/assets/js/48.8c0802c7.js"><link rel="prefetch" href="/KeepJava/assets/js/49.b513c38f.js"><link rel="prefetch" href="/KeepJava/assets/js/5.be33ac2d.js"><link rel="prefetch" href="/KeepJava/assets/js/50.a91e4a91.js"><link rel="prefetch" href="/KeepJava/assets/js/51.94807067.js"><link rel="prefetch" href="/KeepJava/assets/js/52.55860f57.js"><link rel="prefetch" href="/KeepJava/assets/js/53.65662d2d.js"><link rel="prefetch" href="/KeepJava/assets/js/6.c9a4e2e1.js"><link rel="prefetch" href="/KeepJava/assets/js/7.6d22e957.js"><link rel="prefetch" href="/KeepJava/assets/js/8.4b0668c3.js"><link rel="prefetch" href="/KeepJava/assets/js/9.c098ded9.js">
    <link rel="stylesheet" href="/KeepJava/assets/css/0.styles.0321c629.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/KeepJava/" class="home-link router-link-active"><img src="/KeepJava/assets/logo/java.svg" alt="KeepJava" class="logo"> <span class="site-name can-hide">KeepJava</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/KeepJava/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java SE" class="dropdown-title"><span class="title">Java SE</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java SE" class="mobile-dropdown-title"><span class="title">Java SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/introduction/" class="nav-link">
  Java 语言基础
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/version/" class="nav-link">
  Java 发展简史
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/object/" class="nav-link">
  面向对象编程
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/reflection/" class="nav-link">
  Java 反射
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/annotation/" class="nav-link">
  Java 注解
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/exceptions/" class="nav-link">
  Java 异常
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/generics/" class="nav-link">
  Java 泛型
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/collection/" class="nav-link">
  Java 集合
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/io/" class="nav-link">
  Java IO
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/concurrency/" class="nav-link">
  Java 并发编程
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/skill/" class="nav-link">
  Java 额外技能
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java EE" class="dropdown-title"><span class="title">Java EE</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java EE" class="mobile-dropdown-title"><span class="title">Java EE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/KeepJava/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/KeepJava/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-subitem"><a href="/KeepJava/" class="nav-link">
  Spring MVC
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          非关系型 (NoSQL)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/KeepJava/db/mongo/" class="nav-link">
  MongoDB
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/KeepJava/" class="nav-link">
  分布式
</a></div><div class="nav-item"><a href="/KeepJava/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/KeepJava/solution/" class="nav-link">
  解决方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="思想|概念" class="dropdown-title"><span class="title">思想|概念</span> <span class="arrow down"></span></button> <button type="button" aria-label="思想|概念" class="mobile-dropdown-title"><span class="title">思想|概念</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/KeepJava/idea/patterns/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><a href="/KeepJava/tools/" class="nav-link">
  工具|技能
</a></div> <a href="https://github.com/pycrab" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/KeepJava/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java SE" class="dropdown-title"><span class="title">Java SE</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java SE" class="mobile-dropdown-title"><span class="title">Java SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/introduction/" class="nav-link">
  Java 语言基础
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/version/" class="nav-link">
  Java 发展简史
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/object/" class="nav-link">
  面向对象编程
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/reflection/" class="nav-link">
  Java 反射
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/annotation/" class="nav-link">
  Java 注解
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/exceptions/" class="nav-link">
  Java 异常
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/generics/" class="nav-link">
  Java 泛型
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/collection/" class="nav-link">
  Java 集合
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/io/" class="nav-link">
  Java IO
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/concurrency/" class="nav-link">
  Java 并发编程
</a></li><li class="dropdown-item"><!----> <a href="/KeepJava/jdk/skill/" class="nav-link">
  Java 额外技能
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java EE" class="dropdown-title"><span class="title">Java EE</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java EE" class="mobile-dropdown-title"><span class="title">Java EE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/KeepJava/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/KeepJava/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-subitem"><a href="/KeepJava/" class="nav-link">
  Spring MVC
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          非关系型 (NoSQL)
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/KeepJava/db/mongo/" class="nav-link">
  MongoDB
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/KeepJava/" class="nav-link">
  分布式
</a></div><div class="nav-item"><a href="/KeepJava/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/KeepJava/solution/" class="nav-link">
  解决方案
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="思想|概念" class="dropdown-title"><span class="title">思想|概念</span> <span class="arrow down"></span></button> <button type="button" aria-label="思想|概念" class="mobile-dropdown-title"><span class="title">思想|概念</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/KeepJava/idea/patterns/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><a href="/KeepJava/tools/" class="nav-link">
  工具|技能
</a></div> <a href="https://github.com/pycrab" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL 数据库索引</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/KeepJava/db/mysql/indexes.html#为什么要创建索引" class="sidebar-link">为什么要创建索引</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/KeepJava/db/mysql/indexes.html#b-tree索引原理" class="sidebar-link">B+Tree索引原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#查询算法演进" class="sidebar-link">查询算法演进</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#最左匹配原则" class="sidebar-link">最左匹配原则</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#b-tree索引分类" class="sidebar-link">B+Tree索引分类</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#聚集索引" class="sidebar-link" style="padding-left:3rem;">聚集索引</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#非聚集索引" class="sidebar-link" style="padding-left:3rem;">非聚集索引</a></li></ul></li><li><a href="/KeepJava/db/mysql/indexes.html#索引失效的因素" class="sidebar-link">索引失效的因素</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/KeepJava/db/mysql/indexes.html#sql调优" class="sidebar-link">SQL调优</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#基于业务逻辑的优化" class="sidebar-link">基于业务逻辑的优化</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#基于连接的sql调优" class="sidebar-link">基于连接的SQL调优</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#基于索引的sql调优" class="sidebar-link">基于索引的SQL调优</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#基于空间的sql调优" class="sidebar-link">基于空间的SQL调优</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#基于使用频度的sql调优" class="sidebar-link">基于使用频度的SQL调优</a></li></ul></li><li><a href="/KeepJava/db/mysql/indexes.html#附录" class="sidebar-link">附录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#mysql存储引擎支持索引" class="sidebar-link">MySQL存储引擎支持索引</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#索引操作示例" class="sidebar-link">索引操作示例</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#查看执行计划" class="sidebar-link">查看执行计划</a></li><li class="sidebar-sub-header"><a href="/KeepJava/db/mysql/indexes.html#测试索引命中" class="sidebar-link">测试索引命中</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>主流5.6版本及以后</p></blockquote> <h2 id="为什么要创建索引"><a href="#为什么要创建索引" class="header-anchor">🎋</a> 为什么要创建索引</h2> <p>MySQL官方对索引的定义为：索引（Index）是帮助MySQL<strong>高效获取数据</strong>的数据结构。</p> <ul><li>使用索引的优点如下：
<ul><li>减少IO访问次数，使用索引最多需要三次左右IO即可获取到数据</li> <li>缩小每次扫描的数据量，避免内存加载用不到的块</li> <li>使用覆盖索引，将随机IO变成顺序IO，加快查询效率</li> <li>索引有序存储，避免排序和临时表，减少内存消耗</li></ul></li> <li>使用索引的缺点：
<ul><li>耗费创建和维护的时间</li> <li>耗费物理空间</li></ul></li></ul> <h2 id="b-tree索引原理"><a href="#b-tree索引原理" class="header-anchor">🎋</a> B+Tree索引原理</h2> <h3 id="查询算法演进"><a href="#查询算法演进" class="header-anchor">🎋</a> 查询算法演进</h3> <p>参考<a href="https://developer.aliyun.com/article/65126" target="_blank" rel="noopener noreferrer">查询算法及索引实现原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>1、为什么使用<strong>B+Tree索引</strong>而不使用Hash索引？</p> <p>​		<strong>B+Tree索引</strong>是一种平衡多路搜索树，检索时需要从根节点到叶子节点逐级查找，时间复杂度是O(logN)，而且叶子节点添加了顺序访问指针，非常适合排序和范围查询。</p> <p>​		而<strong>Hash索引</strong>是哈希表，能够在O(1)时间内快速精确找到，但是对排序和范围查找不友好，需要全表扫描，还有可能出现哈希碰撞问题，因此不常用。</p> <p>2、B+Tree和B-Tree的区别？</p> <ul><li>B-Tree的所有节点既存键key也存数据data；而B+Tree只有叶子节点既存key又存data，其他节点只存key</li> <li>B-Tree对每个节点进行二分查找，找到直接返回data；而B+Tree每次都是从根节点逐级查找到叶子节点，然后返回叶子节点的data</li> <li>数据库中使用的B+Tree进行了优化，叶子节点添加了单向的顺序访问指针，范围查找时找到开始的叶子然后顺序访问相邻的叶子即可。</li></ul> <h3 id="最左匹配原则"><a href="#最左匹配原则" class="header-anchor">🎋</a> 最左匹配原则</h3> <p>​		MySQL可以对一列建立索引，也可以对多列按照顺序建立联合索引。最左匹配原则指的是，where查询条件中，会根据索引一直向右进行精确查找，如果中断或者不匹配，或遇到这几个范围查询（in，&gt;，&lt;，between，like 开头为%等）查找后就不继续匹配了。</p> <p>​		比如我建立一个联合索引（a, b, c），那么最左匹配的意思是，查询a，或者ab，或者abc可以匹配该索引，其他的比如b，bc，c则不符合匹配规则，无法命中索引。</p> <h3 id="b-tree索引分类"><a href="#b-tree索引分类" class="header-anchor">🎋</a> B+Tree索引分类</h3> <blockquote><p>在InnoDB存储引擎中，B+Tree索引分为聚集索引和非聚集索引。而在MyISAM存储引擎中，只有非聚集索引。</p></blockquote> <p>​		先通过一个常识来理解，我们查询汉语字典的时候，往往有两种方式，一种是根据拼音目录查找，一种是根据部首目录查找。因为汉语字典是按照拼音顺序组织的，所以根据拼音可以顺序查找，而根据部首是跳跃查找（因为相同部首的不一定在相邻的页，按部首排序的汉字对拼音来说是乱序的）。在这里拼音目录就相当于聚集索引，部首目录就相当于非聚集索引。</p> <p>​		当我们查表（查询字典）时，通常根据聚集索引（按拼音）或者非聚集索引（按部首）精确查找或者范围查找，要比全表扫描（随机翻看字典）快的多。</p> <h4 id="聚集索引"><a href="#聚集索引" class="header-anchor">🎋</a> 聚集索引</h4> <blockquote><p>叶子节点存储的是行记录和主键列的B+Tree，叫做聚集索引。</p> <p>聚集索引有且只有一个，聚集索引对应的列唯一且非空，能够唯一标识一条记录。InnoDB存储引擎会根据聚集索引按照顺序存储行记录，所以其实InnoDB表存储的数据文件本身就是索引文件。</p></blockquote> <ul><li><p>聚集索引是有序的，进行精确查找和范围查找非常快。</p></li> <li><p>聚集索引的声明：</p> <ul><li>如果表声明了主键，则在主键列上建立聚集索引；</li> <li>如果没有主键，则会选择表中第一个唯一非空的列作为聚集索引；</li> <li>否则，InnoDB引擎会为每行数据添加一个rowId作为聚集索引。</li></ul></li> <li><p>具体选择哪一列作为聚集索引，需要慎重考虑。</p></li></ul> <h4 id="非聚集索引"><a href="#非聚集索引" class="header-anchor">🎋</a> 非聚集索引</h4> <blockquote><p>叶子节点存储的是索引列和主键列的B+Tree，叫非聚集索引。</p></blockquote> <ul><li><p>非聚集索引又可以细分为以下几种：</p> <ul><li><p>普通索引</p> <p>为了加快查询或排序速度在列上建立的索引，由关键字key或者index定义。</p></li> <li><p>唯一索引</p> <p>具有唯一性的列建立的索引叫唯一索引，保证插入数据的唯一性，由关键字unique定义。</p> <p>唯一索引和聚集索引的不同在于叶子节点存储的数据和能否为空。</p></li> <li><p>外键索引</p> <p>如果为外键字段定义了外键约束条件，MySQL会自动建立外键索引去管理外键约束。</p></li> <li><p>联合索引</p> <p>在多个列上建立一个联合索引，MySQL会根据最左匹配原则进行查询。</p> <p>建立联合索引覆盖要查询的列是避免回表的一种方式（覆盖索引）。</p></li> <li><p>全文索引</p> <p>全文索引主要是为了检索大文本数据中的关键字的信息，是目前搜索引擎数据库使用的一种技术。</p> <p>5.6版本及以后InnoDB存储引擎也支持。</p></li> <li><p>主键索引</p> <p>在InnoDB存储引擎中指的就是聚集索引，在MyISAM存储引擎中指的是在主键列上建立的索引。</p></li></ul></li></ul> <h2 id="索引失效的因素"><a href="#索引失效的因素" class="header-anchor">🎋</a> 索引失效的因素</h2> <blockquote><p>如何才能使用索引，并且确实能命中索引，而不是全表扫描？导致索引失效的因素有以下：</p></blockquote> <ul><li><p>数据表存储引擎不支持该索引</p></li> <li><p>没有遵守最左匹配原则</p> <ul><li>LIKE关键字匹配字符串的第一个字符为任意值%等</li> <li>遇到范围查询，后面的不走索引</li> <li>对于联合索引，第一个就没命中，不符合最左匹配原则</li></ul></li> <li><p>索引列参与计算、使用函数、类型转换</p> <p>由于索引中存储的是列原始数据，不可能在查询的时候去全表重新计算，因此不走索引。</p> <p>可以改为计算/转换另一边的数据；或者建立函数索引。</p> <ul><li><p>字符串类型却传入数字类型比较</p> <p>默认会把字符串类型转为数字类型（从第一个字符截取到第一个非数字字符）。</p> <p>数字应该加引号。</p></li> <li><p>日期类型和时间戳比较（待测试）</p></li></ul></li> <li><p>当查询优化器判断全表扫描（扫描全部的聚集索引）比使用索引所需的成本更少时，可能会执行全表扫描</p> <p>比如查询大量的数据时，列没有建立索引导致回表，从而进行大量随机IO</p> <ul><li>如果查询的列只包含非聚集索引列（或者也含有主键列），则直接从叶子节点中返回数据即可，但是如果查询的列包含索引列之外的列，则需要根据叶子节点中的主键列进行二次查询，到聚集索引中查询需要的数据，这就叫做回表。</li></ul></li></ul> <h2 id="sql调优"><a href="#sql调优" class="header-anchor">🎋</a> SQL调优</h2> <p>SQL调优一方面是根据经验，一方面是遵守规范，<a href="https://dev.mysql.com/doc/refman/8.0/en/optimization.html" target="_blank" rel="noopener noreferrer">MySQL官方指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>专门有一节告诉我们如何优化性能。这里仅列出几个常规操作。</p> <h3 id="基于业务逻辑的优化"><a href="#基于业务逻辑的优化" class="header-anchor">🎋</a> 基于业务逻辑的优化</h3> <ul><li><p>批量操作优于循环单条操作</p></li> <li><p>SQL不要掺杂过多的业务处理</p> <p>复杂SQL会导致CPU大量计算。</p></li></ul> <h3 id="基于连接的sql调优"><a href="#基于连接的sql调优" class="header-anchor">🎋</a> 基于连接的SQL调优</h3> <ul><li>如果有连接，应该不使用连接通过执行计划，看哪个表应该作为驱动表</li> <li>小表驱动大表，上一个结果集作为驱动表遍历查询下一个被驱动表，减少循环总次数</li> <li>优先优化内层Nested Loop循环，内存循环执行次数最多，行数越少性能越高</li> <li><img src="https://pycrab.github.io/KeepJava/assets/media/db-mysql-indexes-joinprocess.png" alt=""></li> <li><img src="https://pycrab.github.io/KeepJava/assets/media/db-mysql-indexes-nlj.png" alt="image-20200917215300631"></li> <li><img src="https://pycrab.github.io/KeepJava/assets/media/db-mysql-indexes-drive.png" alt="image-20200917215314237"></li></ul> <h3 id="基于索引的sql调优"><a href="#基于索引的sql调优" class="header-anchor">🎋</a> 基于索引的SQL调优</h3> <ul><li><p>建立索引</p> <ul><li><p>主键列、外键列、连接列、排序列、分组列按情况建立索引</p></li> <li><p>对区分度比较高的列建立索引，或者区分度低但是访问不均匀的列建立索引</p> <p>区分度 = select count ( distinct col) / count ( * )，区分度越高，过滤后的行数越少</p></li> <li><p>尽量扩展索引，而不是新建索引，联合索引比多个普通索引快</p> <p>在and连接条件中，如果是普通索引只会命中其中一个。</p></li> <li><p>联合索引也遵从区分度高的列在前，能够过滤掉更多的行</p> <p>要综合考虑该表的所有查询方式，评估覆盖尽可能多的情况。</p></li> <li><p>尽量使用覆盖索引，减少回表</p></li> <li><p>冗余索引或从不使用的索引及时删除</p> <p>比如索引( a, b )和索引( a )同时存在，( a )就是冗余索引，MySQL 5.7 版本后，可以通过查询 sys 库的 <code>schema_redundant_indexes</code> 表来查看冗余索引</p></li> <li><p>索引不宜过多，多了会影响插入和删除性能</p></li> <li><p>索引不宜过长，太长会增大索引文件的大小和维护开销</p> <ul><li><p>主键索引尽可能小（非聚集索引叶子都会存储主键）</p></li> <li><p>对特殊字段建立前缀索引</p> <p>用列的前缀代替整个列作为索引的key，当前缀长度合适时，区分度接近于全列索引。</p> <p>但是前缀索引不能用于排序列、分组列，也不能用作覆盖索引。</p></li></ul></li></ul></li> <li><p>命中索引</p> <ul><li><p>遵守最左匹配原则，区分度高的在前，范围查询放在最后</p> <p>等值查询=和范围查询in可以乱序，MySQL的查询优化器可以优化成索引可识别的形式</p> <p>但是最好区分度高的在前，减少优化器重新编译。</p></li> <li><p>索引列不要参与运算、使用函数，避免自动类型转换</p></li> <li><p>范围查询指定最值（待测试）</p> <p>由于B+Tree索引结构添加了单向的顺序访问指针，提高了区间访问的性能。</p></li> <li><p>查询优化器弃用索引，这时需要强制使用索引（待查询资料验证）</p></li></ul></li> <li><p>不命中索引</p> <ul><li>查询数据量超过40%，或者其他特殊情况，可能全表扫描更快</li></ul></li></ul> <h3 id="基于空间的sql调优"><a href="#基于空间的sql调优" class="header-anchor">🎋</a> 基于空间的SQL调优</h3> <ul><li><p>减少临时表的创建和销毁</p> <p>参考<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485117&amp;idx=1&amp;sn=92361755b7c3de488b415ec4c5f46d73&amp;chksm=cea24976f9d5c060babe50c3747616cce63df5d50947903a262704988143c2eeb4069ae45420&amp;token=79317275&amp;lang=zh_CN#rd" target="_blank" rel="noopener noreferrer">MySQL高性能优化建议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><p>避免使用大数据量的子查询</p> <p>优化为连接join操作。</p></li> <li><p>避免同时关联连接join多个表</p> <p>有可能导致服务器内存溢出。</p></li> <li><p>明显不会重复时使用union　all而不是union</p> <p>union会生成临时表去重</p></li></ul></li> <li><p>针对大表优化</p> <p>参考<a href="https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=%e5%a4%a7%e8%a1%a8%e4%bc%98%e5%8c%96" target="_blank" rel="noopener noreferrer">大表优化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><p>查询时一定限定范围</p></li> <li><p>读写分离
主库写，从库读</p></li> <li><p>垂直分区</p> <p>按列拆分表，甚至放到单独的库做分库。</p> <ul><li>优点：可以使得列数据变小，在查询时减少读取的Block数，减少I/O次数。此外，垂直分区可以简化表的结构，易于维护。</li> <li>缺点：主键会出现冗余，需要管理冗余列，并会引起Join操作，可以通过在应用层进行Join来解决。此外，垂直分区会让事务变得更加复杂。</li></ul></li> <li><p>水平分区</p> <p>按某种策略将数据分散到不同的表或者库中。</p> <ul><li>客户端代理</li> <li>中间件代理</li></ul></li></ul></li></ul> <h3 id="基于使用频度的sql调优"><a href="#基于使用频度的sql调优" class="header-anchor">🎋</a> 基于使用频度的SQL调优</h3> <ul><li>建立视图</li> <li>建立存储过程</li></ul> <h2 id="附录"><a href="#附录" class="header-anchor">🎋</a> 附录</h2> <h3 id="mysql存储引擎支持索引"><a href="#mysql存储引擎支持索引" class="header-anchor">🎋</a> MySQL存储引擎支持索引</h3> <p><a href="https://dev.mysql.com/doc/refman/8.0/en/storage-engines.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>支持的索引类型如下：</p> <p><img src="https://pycrab.github.io/KeepJava/assets/media/db-mysql-index-01.png" alt=""></p> <p><img src="https://pycrab.github.io/KeepJava/assets/media/db-mysql-index-02.png" alt=""></p> <p>​		InnoDB中的哈希索引我们无法手动创建，因为它是存储引擎为了加速索引寻址而自动创建的索引，相当于索引的索引，key值是索引的键值，value 是索引记录页面的位置。</p> <h3 id="索引操作示例"><a href="#索引操作示例" class="header-anchor">🎋</a> 索引操作示例</h3> <h3 id="查看执行计划"><a href="#查看执行计划" class="header-anchor">🎋</a> 查看执行计划</h3> <h3 id="测试索引命中"><a href="#测试索引命中" class="header-anchor">🎋</a> 测试索引命中</h3></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/pycrab/KeepJava/edit/master/db/mysql/indexes.md" target="_blank" rel="noopener noreferrer">Edit Me On Github</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/12/3 下午3:48:31</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/KeepJava/assets/js/app.95e4ac80.js" defer></script><script src="/KeepJava/assets/js/2.73d6ef14.js" defer></script><script src="/KeepJava/assets/js/10.f77a3b1c.js" defer></script>
  </body>
</html>
